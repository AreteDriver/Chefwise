(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[102],{5225:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/planner",function(){return a(7010)}])},9340:function(e,t,a){"use strict";a.d(t,{Z:function(){return y}});var s=a(7294),r=a(3914),n=a(8232);let l=e=>i(JSON.stringify(e,Object.keys(e).sort())),i=e=>{let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;return t.toString(36)};class o{async init(){return this.db?this.db:new Promise((e,t)=>{let a=indexedDB.open(this.dbName,1);a.onerror=()=>t(a.error),a.onsuccess=()=>{this.db=a.result,e(this.db)},a.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:"key"})}})}async get(e){return await this.init(),new Promise((t,a)=>{let s=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);s.onerror=()=>a(s.error),s.onsuccess=()=>{let a=s.result;if(!a){t(null);return}if(Date.now()-a.timestamp>this.TTL){this.delete(e).catch(e=>console.error("Cache cleanup error:",e)),t(null);return}t(a.value)}})}async set(e,t){return await this.init(),new Promise((a,s)=>{let r=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put({key:e,value:t,timestamp:Date.now()});r.onerror=()=>s(r.error),r.onsuccess=()=>a()})}async delete(e){return await this.init(),new Promise((t,a)=>{let s=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);s.onerror=()=>a(s.error),s.onsuccess=()=>t()})}async clear(){return await this.init(),new Promise((e,t)=>{let a=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();a.onerror=()=>t(a.error),a.onsuccess=()=>e()})}async getStats(){return await this.init(),new Promise((e,t)=>{let a=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();a.onerror=()=>t(a.error),a.onsuccess=()=>{let t=a.result,s=Date.now(),r=t.filter(e=>s-e.timestamp<=this.TTL);e({total:t.length,valid:r.length,expired:t.length-r.length,size:JSON.stringify(t).length})}})}constructor(e="chefwise-cache",t="ai-responses"){this.dbName=e,this.storeName=t,this.db=null,this.TTL=864e5}}let c=new o;class d{async get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>this.TTL?(this.cache.delete(e),null):t.value:null}async set(e,t){this.cache.set(e,{value:t,timestamp:Date.now()})}async delete(e){this.cache.delete(e)}async clear(){this.cache.clear()}async getStats(){let e=Array.from(this.cache.values()),t=Date.now(),a=e.filter(e=>t-e.timestamp<=this.TTL);return{total:e.length,valid:a.length,expired:e.length-a.length,size:JSON.stringify(e).length}}constructor(){this.cache=new Map,this.TTL=864e5}}let u=new d,m=()=>window.indexedDB?c:u;var h=a(9356);let g=0;async function p(e,t){g++;let a={id:"plan_".concat(e,"_").concat(Date.now(),"_").concat(g,"_").concat(Math.random().toString(36).substr(2,5)),userId:e,...t,savedAt:new Date().toISOString()};return await h.Nf.put(h.RF.MEAL_PLANS,a),a}async function x(e){let t=await h.Nf.getByIndex(h.RF.MEAL_PLANS,"userId",e);return 0===t.length?null:(t.sort((e,t)=>new Date(t.savedAt)-new Date(e.savedAt)),t[0])}var b=a(6727),y=()=>{let[e,t]=(0,s.useState)(!1),[a,i]=(0,s.useState)(null),[o,c]=(0,s.useState)(null);return{loading:e,error:a,result:o,generateRecipe:async e=>{t(!0),i(null);try{let a=!1!==e.useCache;if(a){let a=m(),s=l({type:"recipe",...e}),r=await a.get(s);if(r)return c(r),t(!1),r}let s=(0,r.V1)(n.wk,"generateRecipe"),i=await s(e);if(a&&i.data){let t=m(),a=l({type:"recipe",...e});t.set(a,i.data).catch(e=>{console.warn("Failed to cache recipe response:",e)}),e.userId&&(0,b.qv)(e.userId,i.data).catch(e=>{console.warn("Failed to save recipe offline:",e)})}return c(i.data),i.data}catch(e){throw i(e.message||"Failed to generate recipe"),console.error("Recipe generation error:",e),e}finally{t(!1)}},generateSubstitutions:async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(!0),i(null);try{let s=!1!==a.useCache;if(s){let s=m(),r=l({type:"substitution",ingredient:e,...a}),n=await s.get(r);if(n)return c(n),t(!1),n}let i=(0,r.V1)(n.wk,"getSubstitutions"),o=await i({ingredient:e,...a});if(s&&o.data){let t=m(),s=l({type:"substitution",ingredient:e,...a});t.set(s,o.data).catch(e=>{console.warn("Failed to cache substitution response:",e)})}return c(o.data),o.data}catch(e){throw i(e.message||"Failed to generate substitutions"),console.error("Substitution error:",e),e}finally{t(!1)}},generateMealPlan:async e=>{t(!0),i(null);try{let a=!1!==e.useCache;if(a){let a=m(),s=l({type:"mealplan",...e}),r=await a.get(s);if(r)return c(r),t(!1),r}let s=(0,r.V1)(n.wk,"generateMealPlan"),i=await s(e);if(a&&i.data){let t=m(),a=l({type:"mealplan",...e});t.set(a,i.data).catch(e=>{console.warn("Failed to cache meal plan response:",e)}),e.userId&&p(e.userId,i.data).catch(e=>{console.warn("Failed to save meal plan offline:",e)})}return c(i.data),i.data}catch(e){throw i(e.message||"Failed to generate meal plan"),console.error("Meal plan error:",e),e}finally{t(!1)}},getPantrySuggestions:async e=>{t(!0),i(null);try{let t=(0,r.V1)(n.wk,"getPantrySuggestions"),a=await t(e);return c(a.data),a.data}catch(e){throw i(e.message||"Failed to get pantry suggestions"),console.error("Pantry suggestions error:",e),e}finally{t(!1)}},loadCachedMealPlan:async e=>{if(!e)return null;try{let t=await x(e);if(t)return c(t),t;return null}catch(e){return console.warn("Failed to load cached meal plan:",e),null}}}}},7010:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(5893),r=a(7294),n=a(1163),l=a(3148),i=a(6495);function o(e){let{mealPlan:t,onGeneratePlan:a}=e,[n,l]=(0,r.useState)(0);if(!t||!t.days||0===t.days.length)return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Meal Planner"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Generate a personalized meal plan based on your dietary preferences and macro goals."}),(0,s.jsx)("button",{onClick:a,className:"bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary/90 transition-colors",children:"Generate Meal Plan"})]});let o=t.days[n],c={labels:["Protein","Carbs","Fat"],datasets:[{data:[o.dailyTotals.protein,o.dailyTotals.carbs,o.dailyTotals.fat],backgroundColor:["#10B981","#F59E0B","#EC4899"],borderWidth:0}]},d={labels:t.days.map(e=>"Day ".concat(e.day)),datasets:[{label:"Calories",data:t.days.map(e=>e.dailyTotals.calories),backgroundColor:"#10B981"}]};return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Your Meal Plan"}),(0,s.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2",children:t.days.map((e,t)=>(0,s.jsxs)("button",{onClick:()=>l(t),className:"px-4 py-2 rounded-lg whitespace-nowrap transition-colors ".concat(n===t?"bg-primary text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Day ",e.day]},e.day))})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3",children:new Date(o.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),(0,s.jsx)("div",{className:"space-y-4",children:o.meals.map((e,t)=>(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-primary transition-colors",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-xs font-semibold text-primary uppercase",children:e.type}),(0,s.jsx)("h4",{className:"text-lg font-semibold",children:e.title})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:[e.macros.calories," cal"]})]}),(0,s.jsxs)("div",{className:"flex gap-4 text-sm text-gray-600",children:[(0,s.jsxs)("span",{children:["P: ",e.macros.protein,"g"]}),(0,s.jsxs)("span",{children:["C: ",e.macros.carbs,"g"]}),(0,s.jsxs)("span",{children:["F: ",e.macros.fat,"g"]})]}),e.ingredients&&(0,s.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,s.jsx)("span",{className:"font-medium",children:"Ingredients: "}),e.ingredients.slice(0,3).join(", "),e.ingredients.length>3&&"..."]})]},t))})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h4",{className:"font-semibold mb-2",children:"Daily Totals"}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Calories"}),(0,s.jsx)("div",{className:"text-lg font-bold",children:o.dailyTotals.calories})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Protein"}),(0,s.jsxs)("div",{className:"text-lg font-bold",children:[o.dailyTotals.protein,"g"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Carbs"}),(0,s.jsxs)("div",{className:"text-lg font-bold",children:[o.dailyTotals.carbs,"g"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Fat"}),(0,s.jsxs)("div",{className:"text-lg font-bold",children:[o.dailyTotals.fat,"g"]})]})]})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold mb-3 text-center",children:"Macro Distribution"}),(0,s.jsx)("div",{className:"max-w-xs mx-auto",children:(0,s.jsx)(i.$I,{data:c})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold mb-3 text-center",children:"Weekly Calories"}),(0,s.jsx)(i.$Q,{data:d,options:{responsive:!0,plugins:{legend:{display:!1}}}})]})]}),t.shoppingList&&t.shoppingList.length>0&&(0,s.jsxs)("div",{className:"mt-6 border-t pt-6",children:[(0,s.jsx)("h4",{className:"font-semibold mb-3",children:"Shopping List"}),(0,s.jsx)("div",{className:"grid sm:grid-cols-2 md:grid-cols-3 gap-2",children:t.shoppingList.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center text-sm",children:[(0,s.jsx)("input",{type:"checkbox",className:"mr-2"}),(0,s.jsxs)("span",{children:[e.item," - ",e.quantity]})]},t))})]})]})}l.kL.register(l.qi,l.u,l.De,l.uw,l.f$,l.ZL);var c=a(5876),d=a(9340),u=a(1158);function m(e){let{user:t}=e,a=(0,n.useRouter)(),[l,i]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),[g,p]=(0,r.useState)(!1),[x,b]=(0,r.useState)({calories:2e3,protein:150,carbs:200,fat:65}),[y,f]=(0,r.useState)(7),{generateMealPlan:j,loadCachedMealPlan:w,loading:N}=(0,d.Z)(),{isOnline:v}=(0,u.kH)(),S=(0,r.useRef)(!1);if((0,r.useEffect)(()=>{t&&!S.current&&(S.current=!0,w(t.uid).then(e=>{e&&(i(e),p(!0))}))},[t,w]),!t)return a.push("/"),null;let k=async()=>{if(y>14){alert("Please select up to ".concat(14," days."));return}if(!v){alert("You are offline. Please connect to the internet to generate a new meal plan.");return}try{let e=await j({days:y,macroGoals:x,preferences:{},userId:t.uid});i(e),p(!1),h(!1)}catch(e){console.error("Error generating meal plan:",e)}};return(0,s.jsx)(c.Z,{user:t,currentPage:"planner",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[m&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Meal Plan Settings"}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Days"}),(0,s.jsx)("input",{type:"number",min:"1",max:"30",value:y,onChange:e=>f(parseInt(e.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Your plan allows up to ",14," days",y>14&&(0,s.jsxs)("span",{className:"text-primary font-medium",children:[" ","(Upgrade for longer plans)"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Daily Calories"}),(0,s.jsx)("input",{type:"number",value:x.calories,onChange:e=>b({...x,calories:parseInt(e.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Protein (g)"}),(0,s.jsx)("input",{type:"number",value:x.protein,onChange:e=>b({...x,protein:parseInt(e.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Carbs (g)"}),(0,s.jsx)("input",{type:"number",value:x.carbs,onChange:e=>b({...x,carbs:parseInt(e.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fat (g)"}),(0,s.jsx)("input",{type:"number",value:x.fat,onChange:e=>b({...x,fat:parseInt(e.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:k,disabled:N,className:"flex-1 bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary/90 transition-colors disabled:bg-gray-300",children:N?"Generating...":"Generate Plan"}),(0,s.jsx)("button",{onClick:()=>h(!1),className:"px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"})]})]}),g&&l&&(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsxs)("span",{className:"text-sm text-blue-700",children:["Showing your saved meal plan. ",v?"Generate a new plan to update.":"Connect to the internet to generate a new plan."]})]}),(0,s.jsx)(o,{mealPlan:l,onGeneratePlan:()=>h(!0)})]})})}}},function(e){e.O(0,[196,710,996,888,774,179],function(){return e(e.s=5225)}),_N_E=e.O()}]);