(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{9343:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pantry",function(){return r(9569)}])},7623:function(e,t,r){"use strict";r(5893),r(1163),r(2753),r(8232)},9340:function(e,t,r){"use strict";r.d(t,{Z:function(){return N}});var a=r(7294),n=r(3914),s=r(8232);let i=e=>o(JSON.stringify(e,Object.keys(e).sort())),o=e=>{let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return t.toString(36)};class c{async init(){return this.db?this.db:new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>{this.db=r.result,e(this.db)},r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:"key"})}})}async get(e){return await this.init(),new Promise((t,r)=>{let a=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);a.onerror=()=>r(a.error),a.onsuccess=()=>{let r=a.result;if(!r){t(null);return}if(Date.now()-r.timestamp>this.TTL){this.delete(e).catch(e=>console.error("Cache cleanup error:",e)),t(null);return}t(r.value)}})}async set(e,t){return await this.init(),new Promise((r,a)=>{let n=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put({key:e,value:t,timestamp:Date.now()});n.onerror=()=>a(n.error),n.onsuccess=()=>r()})}async delete(e){return await this.init(),new Promise((t,r)=>{let a=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);a.onerror=()=>r(a.error),a.onsuccess=()=>t()})}async clear(){return await this.init(),new Promise((e,t)=>{let r=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();r.onerror=()=>t(r.error),r.onsuccess=()=>e()})}async getStats(){return await this.init(),new Promise((e,t)=>{let r=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();r.onerror=()=>t(r.error),r.onsuccess=()=>{let t=r.result,a=Date.now(),n=t.filter(e=>a-e.timestamp<=this.TTL);e({total:t.length,valid:n.length,expired:t.length-n.length,size:JSON.stringify(t).length})}})}constructor(e="chefwise-cache",t="ai-responses"){this.dbName=e,this.storeName=t,this.db=null,this.TTL=864e5}}let l=new c;class u{async get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>this.TTL?(this.cache.delete(e),null):t.value:null}async set(e,t){this.cache.set(e,{value:t,timestamp:Date.now()})}async delete(e){this.cache.delete(e)}async clear(){this.cache.clear()}async getStats(){let e=Array.from(this.cache.values()),t=Date.now(),r=e.filter(e=>t-e.timestamp<=this.TTL);return{total:e.length,valid:r.length,expired:e.length-r.length,size:JSON.stringify(e).length}}constructor(){this.cache=new Map,this.TTL=864e5}}let d=new u,h=()=>window.indexedDB?l:d;var y=r(9356);let g=0;async function m(e,t){g++;let r={id:"plan_".concat(e,"_").concat(Date.now(),"_").concat(g,"_").concat(Math.random().toString(36).substr(2,5)),userId:e,...t,savedAt:new Date().toISOString()};return await y.Nf.put(y.RF.MEAL_PLANS,r),r}async function p(e){let t=await y.Nf.getByIndex(y.RF.MEAL_PLANS,"userId",e);return 0===t.length?null:(t.sort((e,t)=>new Date(t.savedAt)-new Date(e.savedAt)),t[0])}var f=r(6727),N=()=>{let[e,t]=(0,a.useState)(!1),[r,o]=(0,a.useState)(null),[c,l]=(0,a.useState)(null);return{loading:e,error:r,result:c,generateRecipe:async e=>{t(!0),o(null);try{let r=!1!==e.useCache;if(r){let r=h(),a=i({type:"recipe",...e}),n=await r.get(a);if(n)return l(n),t(!1),n}let a=(0,n.V1)(s.wk,"generateRecipe"),o=await a(e);if(r&&o.data){let t=h(),r=i({type:"recipe",...e});t.set(r,o.data).catch(e=>{console.warn("Failed to cache recipe response:",e)}),e.userId&&(0,f.qv)(e.userId,o.data).catch(e=>{console.warn("Failed to save recipe offline:",e)})}return l(o.data),o.data}catch(e){throw o(e.message||"Failed to generate recipe"),console.error("Recipe generation error:",e),e}finally{t(!1)}},generateSubstitutions:async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(!0),o(null);try{let a=!1!==r.useCache;if(a){let a=h(),n=i({type:"substitution",ingredient:e,...r}),s=await a.get(n);if(s)return l(s),t(!1),s}let o=(0,n.V1)(s.wk,"getSubstitutions"),c=await o({ingredient:e,...r});if(a&&c.data){let t=h(),a=i({type:"substitution",ingredient:e,...r});t.set(a,c.data).catch(e=>{console.warn("Failed to cache substitution response:",e)})}return l(c.data),c.data}catch(e){throw o(e.message||"Failed to generate substitutions"),console.error("Substitution error:",e),e}finally{t(!1)}},generateMealPlan:async e=>{t(!0),o(null);try{let r=!1!==e.useCache;if(r){let r=h(),a=i({type:"mealplan",...e}),n=await r.get(a);if(n)return l(n),t(!1),n}let a=(0,n.V1)(s.wk,"generateMealPlan"),o=await a(e);if(r&&o.data){let t=h(),r=i({type:"mealplan",...e});t.set(r,o.data).catch(e=>{console.warn("Failed to cache meal plan response:",e)}),e.userId&&m(e.userId,o.data).catch(e=>{console.warn("Failed to save meal plan offline:",e)})}return l(o.data),o.data}catch(e){throw o(e.message||"Failed to generate meal plan"),console.error("Meal plan error:",e),e}finally{t(!1)}},getPantrySuggestions:async e=>{t(!0),o(null);try{let t=(0,n.V1)(s.wk,"getPantrySuggestions"),r=await t(e);return l(r.data),r.data}catch(e){throw o(e.message||"Failed to get pantry suggestions"),console.error("Pantry suggestions error:",e),e}finally{t(!1)}},loadCachedMealPlan:async e=>{if(!e)return null;try{let t=await p(e);if(t)return l(t),t;return null}catch(e){return console.warn("Failed to load cached meal plan:",e),null}}}}},9569:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var a=r(5893),n=r(1163);r(7623);var s=r(7294),i=r(9724),o=r(8232),c=r(9356),l=r(7527);let u={SYNCED:"synced",PENDING_CREATE:"pending_create",PENDING_DELETE:"pending_delete"};async function d(e,t){let r=navigator.onLine,a={...e,userId:t,addedAt:new Date().toISOString()};if(r)try{let e={id:(await (0,i.ET)((0,i.hJ)(o.db,"pantryItems"),a)).id,...a,syncStatus:u.SYNCED};return await c.Nf.put(c.RF.PANTRY,e),e}catch(e){console.error("[PantryService] Online add failed, queuing:",e)}let n={id:"temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),...a,syncStatus:u.PENDING_CREATE};return await c.Nf.put(c.RF.PANTRY,n),await l.mK.queueOperation({type:l.NH.CREATE,collection:"pantry",data:a,userId:t}),n}async function h(e,t){let r=navigator.onLine;if(e.startsWith("temp_")){await c.Nf.remove(c.RF.PANTRY,e);return}if(r)try{await (0,i.oe)((0,i.JU)(o.db,"pantryItems",e)),await c.Nf.remove(c.RF.PANTRY,e);return}catch(e){console.error("[PantryService] Online delete failed, queuing:",e)}let a=await c.Nf.get(c.RF.PANTRY,e);a&&await c.Nf.put(c.RF.PANTRY,{...a,syncStatus:u.PENDING_DELETE}),await l.mK.queueOperation({type:l.NH.DELETE,collection:"pantry",docId:e,userId:t})}async function y(e){try{return(await c.Nf.getByIndex(c.RF.PANTRY,"userId",e)).filter(e=>e.syncStatus!==u.PENDING_DELETE)}catch(e){return console.error("[PantryService] Failed to load cache:",e),[]}}async function g(e,t){try{let r=await c.Nf.getByIndex(c.RF.PANTRY,"userId",e),a=new Set(r.filter(e=>e.syncStatus!==u.SYNCED).map(e=>e.id));for(let e of r)a.has(e.id)||await c.Nf.remove(c.RF.PANTRY,e.id);await c.Nf.putMany(c.RF.PANTRY,t)}catch(e){console.error("[PantryService] Failed to cache items:",e)}}async function m(e,t){try{let r=await c.Nf.getByIndex(c.RF.PANTRY,"userId",e),a=r.filter(e=>e.syncStatus===u.PENDING_CREATE),n=new Set(r.filter(e=>e.syncStatus===u.PENDING_DELETE).map(e=>e.id));return[...t.filter(e=>!n.has(e.id)),...a]}catch(e){return console.error("[PantryService] Failed to merge changes:",e),t}}function p(e){return e.syncStatus===u.PENDING_CREATE||e.syncStatus===u.PENDING_DELETE}var f=r(1158);function N(e){let{userId:t,onSuggestRecipes:r}=e,[n,c]=(0,s.useState)([]),[l,N]=(0,s.useState)({name:"",quantity:"",unit:"",category:""}),[w,x]=(0,s.useState)(!0),[b,v]=(0,s.useState)(!1),{isOnline:S,incrementPendingCount:E}=(0,f.kH)();(0,s.useEffect)(()=>{if(!t){x(!1);return}let e=function(e,t,r){if(!e)return t([]),()=>{};let a=null,n=navigator.onLine;y(e).then(e=>{e.length>0&&t(e,!0)});let s=()=>{a&&a();try{let n=(0,i.IO)((0,i.hJ)(o.db,"pantryItems"),(0,i.ar)("userId","==",e));a=(0,i.cf)(n,async a=>{let n=a.docs.map(e=>({id:e.id,...e.data(),syncStatus:u.SYNCED})),s=await m(e,n);await g(e,n),t(s,!1),r&&r(!0)},e=>{console.error("[PantryService] Firestore error:",e),r&&r(!1)})}catch(e){console.error("[PantryService] Failed to set up listener:",e),r&&r(!1)}},c=()=>{n=!0,r&&r(!0),s()},l=()=>{n=!1,r&&r(!1)};return window.addEventListener("online",c),window.addEventListener("offline",l),n&&s(),()=>{a&&a(),window.removeEventListener("online",c),window.removeEventListener("offline",l)}}(t,(e,t)=>{c(e),v(t),x(!1)},e=>{});return()=>e()},[t]);let P=async e=>{if(e.preventDefault(),l.name.trim())try{await d(l,t),N({name:"",quantity:"",unit:"",category:""}),S||E()}catch(e){console.error("Error adding item:",e)}},j=async e=>{try{await h(e,t),S||e.startsWith("temp_")||E()}catch(e){console.error("Error deleting item:",e)}};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Pantry Inventory"}),b&&(0,a.jsx)("span",{className:"text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded",children:"Cached data"})]}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage your ingredients and get recipe suggestions"})]}),(0,a.jsxs)("form",{onSubmit:P,className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-3",children:[(0,a.jsx)("input",{type:"text",placeholder:"Item name",value:l.name,onChange:e=>N({...l,name:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",required:!0}),(0,a.jsx)("input",{type:"text",placeholder:"Quantity",value:l.quantity,onChange:e=>N({...l,quantity:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"}),(0,a.jsx)("input",{type:"text",placeholder:"Unit (oz, cups, etc)",value:l.unit,onChange:e=>N({...l,unit:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"}),(0,a.jsxs)("select",{value:l.category,onChange:e=>N({...l,category:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[(0,a.jsx)("option",{value:"",children:"Category"}),["Protein","Vegetables","Fruits","Grains","Dairy","Spices","Other"].map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors",children:"Add to Pantry"})]}),w?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Loading pantry..."}):0===n.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"Your pantry is empty"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Add ingredients to get started"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[n.length," items in pantry"]}),(0,a.jsx)("button",{onClick:()=>r&&r(n),className:"bg-secondary text-white px-4 py-2 rounded-lg hover:bg-secondary/90 transition-colors text-sm",children:"Suggest Recipes"})]}),(0,a.jsx)("div",{className:"space-y-2",children:n.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg transition-colors ".concat(p(e)?"border-amber-300 bg-amber-50":"border-gray-200 hover:border-primary"),children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium",children:e.name}),p(e)&&(0,a.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-amber-200 text-amber-800 rounded",children:e.syncStatus===u.PENDING_CREATE?"Pending sync":"Pending delete"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.quantity&&e.unit?"".concat(e.quantity," ").concat(e.unit):e.quantity||"No quantity specified",e.category&&(0,a.jsx)("span",{className:"ml-2 px-2 py-0.5 bg-gray-100 rounded text-xs",children:e.category})]})]}),(0,a.jsx)("button",{onClick:()=>j(e.id),className:"text-red-500 hover:text-red-700 ml-4","aria-label":"Delete item",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},e.id))})]})]})}var w=r(5876),x=r(9340);function b(e){let{user:t}=e,r=(0,n.useRouter)(),{generateRecipe:s}=(0,x.Z)();if(!t)return r.push("/"),null;let i=async e=>{let a=e.map(e=>e.name);try{await s({dietType:"general",ingredients:a,preferences:{},userId:t.uid}),r.push("/")}catch(e){console.error("Error suggesting recipes:",e)}};return(0,a.jsx)(w.Z,{user:t,currentPage:"pantry",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsx)(N,{userId:t.uid,onSuggestRecipes:i})})})}},1163:function(e,t,r){e.exports=r(3079)}},function(e){e.O(0,[996,888,774,179],function(){return e(e.s=9343)}),_N_E=e.O()}]);