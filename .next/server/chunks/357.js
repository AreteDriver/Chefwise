"use strict";exports.id=357,exports.ids=[357],exports.modules={5357:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>h});var s=a(6689),n=a(8937),i=a(2169),l=a(9634),o=a(301),c=a(5011),u=e([n,i]);[n,i]=u.then?(await u)():u;let h=()=>{let[e,t]=(0,s.useState)(!1),[a,r]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),d=async e=>{t(!0),r(null);try{let a=!1!==e.useCache;if(a){let a=(0,l.lJ)(),r=(0,l.iu)({type:"recipe",...e}),s=await a.get(r);if(s)return h(s),t(!1),s}let r=(0,n.httpsCallable)(i.wk,"generateRecipe"),s=await r(e);if(a&&s.data){let t=(0,l.lJ)(),a=(0,l.iu)({type:"recipe",...e});t.set(a,s.data).catch(e=>{console.warn("Failed to cache recipe response:",e)}),e.userId&&(0,c.qv)(e.userId,s.data).catch(e=>{console.warn("Failed to save recipe offline:",e)})}return h(s.data),s.data}catch(t){let e=t.message||"Failed to generate recipe";throw r(e),console.error("Recipe generation error:",t),t}finally{t(!1)}},w=async(e,a={})=>{t(!0),r(null);try{let r=!1!==a.useCache;if(r){let r=(0,l.lJ)(),s=(0,l.iu)({type:"substitution",ingredient:e,...a}),n=await r.get(s);if(n)return h(n),t(!1),n}let s=(0,n.httpsCallable)(i.wk,"getSubstitutions"),o=await s({ingredient:e,...a});if(r&&o.data){let t=(0,l.lJ)(),r=(0,l.iu)({type:"substitution",ingredient:e,...a});t.set(r,o.data).catch(e=>{console.warn("Failed to cache substitution response:",e)})}return h(o.data),o.data}catch(t){let e=t.message||"Failed to generate substitutions";throw r(e),console.error("Substitution error:",t),t}finally{t(!1)}},g=async e=>{t(!0),r(null);try{let a=!1!==e.useCache;if(a){let a=(0,l.lJ)(),r=(0,l.iu)({type:"mealplan",...e}),s=await a.get(r);if(s)return h(s),t(!1),s}let r=(0,n.httpsCallable)(i.wk,"generateMealPlan"),s=await r(e);if(a&&s.data){let t=(0,l.lJ)(),a=(0,l.iu)({type:"mealplan",...e});t.set(a,s.data).catch(e=>{console.warn("Failed to cache meal plan response:",e)}),e.userId&&(0,o.ye)(e.userId,s.data).catch(e=>{console.warn("Failed to save meal plan offline:",e)})}return h(s.data),s.data}catch(t){let e=t.message||"Failed to generate meal plan";throw r(e),console.error("Meal plan error:",t),t}finally{t(!1)}},y=async e=>{t(!0),r(null);try{let t=(0,n.httpsCallable)(i.wk,"getPantrySuggestions"),a=await t(e);return h(a.data),a.data}catch(t){let e=t.message||"Failed to get pantry suggestions";throw r(e),console.error("Pantry suggestions error:",t),t}finally{t(!1)}},m=async e=>{if(!e)return null;try{let t=await (0,o.fn)(e);if(t)return h(t),t;return null}catch(e){return console.warn("Failed to load cached meal plan:",e),null}};return{loading:e,error:a,result:u,generateRecipe:d,generateSubstitutions:w,generateMealPlan:g,getPantrySuggestions:y,loadCachedMealPlan:m}};r()}catch(e){r(e)}})},9634:(e,t,a)=>{a.d(t,{iu:()=>r,lJ:()=>o});let r=e=>s(JSON.stringify(e,Object.keys(e).sort())),s=e=>{let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;return t.toString(36)};class n{constructor(e="chefwise-cache",t="ai-responses"){this.dbName=e,this.storeName=t,this.db=null,this.TTL=864e5}async init(){return this.db?this.db:new Promise((e,t)=>{let a=indexedDB.open(this.dbName,1);a.onerror=()=>t(a.error),a.onsuccess=()=>{this.db=a.result,e(this.db)},a.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:"key"})}})}async get(e){return await this.init(),new Promise((t,a)=>{let r=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);r.onerror=()=>a(r.error),r.onsuccess=()=>{let a=r.result;if(!a){t(null);return}if(Date.now()-a.timestamp>this.TTL){this.delete(e).catch(e=>console.error("Cache cleanup error:",e)),t(null);return}t(a.value)}})}async set(e,t){return await this.init(),new Promise((a,r)=>{let s=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put({key:e,value:t,timestamp:Date.now()});s.onerror=()=>r(s.error),s.onsuccess=()=>a()})}async delete(e){return await this.init(),new Promise((t,a)=>{let r=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);r.onerror=()=>a(r.error),r.onsuccess=()=>t()})}async clear(){return await this.init(),new Promise((e,t)=>{let a=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();a.onerror=()=>t(a.error),a.onsuccess=()=>e()})}async getStats(){return await this.init(),new Promise((e,t)=>{let a=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();a.onerror=()=>t(a.error),a.onsuccess=()=>{let t=a.result,r=Date.now(),s=t.filter(e=>r-e.timestamp<=this.TTL);e({total:t.length,valid:s.length,expired:t.length-s.length,size:JSON.stringify(t).length})}})}}new n;class i{constructor(){this.cache=new Map,this.TTL=864e5}async get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>this.TTL?(this.cache.delete(e),null):t.value:null}async set(e,t){this.cache.set(e,{value:t,timestamp:Date.now()})}async delete(e){this.cache.delete(e)}async clear(){this.cache.clear()}async getStats(){let e=Array.from(this.cache.values()),t=Date.now(),a=e.filter(e=>t-e.timestamp<=this.TTL);return{total:e.length,valid:a.length,expired:e.length-a.length,size:JSON.stringify(e).length}}}let l=new i,o=()=>l},301:(e,t,a)=>{a.d(t,{fn:()=>i,ye:()=>n});var r=a(215);let s=0;async function n(e,t){s++;let a={id:`plan_${e}_${Date.now()}_${s}_${Math.random().toString(36).substr(2,5)}`,userId:e,...t,savedAt:new Date().toISOString()};return await r.Nf.put(r.RF.MEAL_PLANS,a),a}async function i(e){let t=await r.Nf.getByIndex(r.RF.MEAL_PLANS,"userId",e);return 0===t.length?null:(t.sort((e,t)=>new Date(t.savedAt)-new Date(e.savedAt)),t[0])}},5011:(e,t,a)=>{a.d(t,{V4:()=>i,eI:()=>l,qv:()=>n,s8:()=>o});var r=a(215);let s=0;async function n(e,t){s++;let a={id:t.id||`recipe_${e}_${Date.now()}_${s}_${Math.random().toString(36).substr(2,5)}`,userId:e,...t,savedAt:new Date().toISOString()};return await r.Nf.put(r.RF.RECIPES,a),a}async function i(e){return(await r.Nf.getByIndex(r.RF.RECIPES,"userId",e)).sort((e,t)=>new Date(t.savedAt)-new Date(e.savedAt))}async function l(e){await r.Nf.remove(r.RF.RECIPES,e)}async function o(e,t){let a=await i(e),r=t.toLowerCase();return a.filter(e=>{let t=e.title?.toLowerCase().includes(r),a=e.tags?.some(e=>e.toLowerCase().includes(r)),s=e.ingredients?.some(e=>e.toLowerCase().includes(r));return t||a||s})}}};